<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>_underscore</title>
  
  <style>
    /* === Finnish Material Design 3 Popup Styles === */
    
    /* Color Tokens */
    :root {
      /* Primary - Lake Blue */
      --md-sys-color-primary: #5B8DB8;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #D4E4F0;
      --md-sys-color-on-primary-container: #1A3A4F;
      
      /* Secondary - Forest Green */
      --md-sys-color-secondary: #6B8E7A;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-secondary-container: #D8E8DD;
      --md-sys-color-on-secondary-container: #253B2C;
      
      /* Surface - Winter White */
      --md-sys-color-surface: #FAFBFC;
      --md-sys-color-on-surface: #1A1C1E;
      --md-sys-color-surface-variant: #E8EAED;
      --md-sys-color-on-surface-variant: #43474E;
      
      /* Surface containers */
      --md-sys-color-surface-container: #EDEEF1;
      --md-sys-color-surface-container-high: #E8EAED;
      --md-sys-color-surface-container-highest: #E2E4E7;
      
      /* Outline */
      --md-sys-color-outline: #73777F;
      --md-sys-color-outline-variant: #C3C7CF;
      
      /* Error */
      --md-sys-color-error: #BA1A1A;
      --md-sys-color-on-error: #FFFFFF;
      
      /* Typography */
      --md-sys-typescale-title-medium-size: 16px;
      --md-sys-typescale-title-medium-weight: 500;
      --md-sys-typescale-body-large-size: 16px;
      --md-sys-typescale-body-medium-size: 14px;
      --md-sys-typescale-label-large-size: 14px;
      --md-sys-typescale-headline-small-size: 24px;
      
      /* Spacing */
      --md-sys-space-2: 8px;
      --md-sys-space-4: 16px;
      --md-sys-space-6: 24px;
      
      /* Motion */
      --md-sys-motion-duration-short2: 100ms;
      --md-sys-motion-duration-short4: 200ms;
      --md-sys-motion-easing-standard: cubic-bezier(0.2, 0, 0, 1);
    }
    
    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      width: 360px;
      min-height: 480px;
      padding: var(--md-sys-space-6);
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--md-sys-color-surface);
      color: var(--md-sys-color-on-surface);
    }
    
    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--md-sys-space-6);
    }
    
    h1 {
      font-size: var(--md-sys-typescale-title-medium-size);
      font-weight: var(--md-sys-typescale-title-medium-weight);
      color: var(--md-sys-color-on-surface);
    }
    
    /* Mode Selector */
    .mode-selector {
      display: flex;
      gap: 2px;
      background: var(--md-sys-color-surface-container-high);
      border-radius: 20px;
      padding: 4px;
    }
    
    #mode-selector {
      padding: 8px 16px;
      border: 1px solid var(--md-sys-color-outline-variant);
      border-radius: 16px;
      background: transparent;
      color: var(--md-sys-color-on-surface-variant);
      font-size: var(--md-sys-typescale-label-large-size);
      cursor: pointer;
      transition: background var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    }
    
    #mode-selector:hover {
      background: rgba(0, 0, 0, 0.08);
    }
    
    #mode-selector:focus {
      outline: 2px solid var(--md-sys-color-primary);
      outline-offset: 2px;
    }
    
    /* Stats Card */
    .stats-card {
      background: var(--md-sys-color-surface-container);
      border-radius: 12px;
      padding: var(--md-sys-space-6);
      text-align: center;
      margin-bottom: var(--md-sys-space-4);
    }
    
    .stat-value {
      font-size: var(--md-sys-typescale-headline-small-size);
      font-weight: 400;
      color: var(--md-sys-color-primary);
      display: block;
      margin-bottom: var(--md-sys-space-2);
    }
    
    .stat-label {
      font-size: var(--md-sys-typescale-body-medium-size);
      color: var(--md-sys-color-on-surface-variant);
    }
    
    /* Buttons */
    .md-filled-button {
      width: 100%;
      background: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      padding: 10px 24px;
      border: none;
      border-radius: 20px;
      font-size: var(--md-sys-typescale-label-large-size);
      font-weight: 500;
      cursor: pointer;
      transition: box-shadow var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    }
    
    .md-filled-button:hover {
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }
    
    .md-filled-button:active {
      box-shadow: none;
    }
    
    .md-filled-button:focus-visible {
      outline: 2px solid var(--md-sys-color-primary);
      outline-offset: 2px;
    }
    
    /* Loading State */
    .state {
      display: none;
      text-align: center;
      padding: var(--md-sys-space-6);
    }
    
    .state:not(.hidden) {
      display: block;
    }
    
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--md-sys-color-surface-variant);
      border-top-color: var(--md-sys-color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto var(--md-sys-space-4);
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Error Display */
    .error-card {
      background: var(--md-sys-color-surface-container);
      border-radius: 12px;
      padding: var(--md-sys-space-6);
      text-align: center;
    }
    
    .error-icon {
      font-size: 48px;
      margin-bottom: var(--md-sys-space-4);
    }
    
    .error-message {
      color: var(--md-sys-color-error);
      margin-bottom: var(--md-sys-space-4);
    }
    
    /* Info Section */
    .info {
      margin-top: var(--md-sys-space-6);
      padding: var(--md-sys-space-4);
      background: var(--md-sys-color-surface-variant);
      border-radius: 8px;
    }
    
    .info p {
      font-size: var(--md-sys-typescale-body-medium-size);
      margin-bottom: var(--md-sys-space-2);
    }
    
    .info ul {
      font-size: 12px;
      color: var(--md-sys-color-on-surface-variant);
      list-style-position: inside;
    }
    
    .info li {
      margin-bottom: 4px;
    }
    
    /* Footer */
    footer {
      margin-top: var(--md-sys-space-6);
      text-align: center;
      font-size: 11px;
      color: var(--md-sys-color-on-surface-variant);
    }
    
    /* Utility Classes */
    .hidden {
      display: none !important;
    }
    
    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>
  <div id="app">
    <!-- Loading State -->
    <div id="loading-state" class="state">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>

    <!-- Error State -->
    <div id="error-state" class="state hidden"></div>

    <!-- Main UI -->
    <div id="main-ui" class="state hidden">
      <header>
        <h1>‚ö° _underscore</h1>
        
        <select id="mode-selector" aria-label="Select mode">
          <option value="walk">üö∂ Walk</option>
          <option value="sprint">üèÉ Sprint</option>
          <option value="vault">üîí Vault</option>
        </select>
      </header>

      <main>
        <section class="stats-card">
          <span class="stat-value" id="highlight-count">0</span>
          <span class="stat-label">Highlights</span>
        </section>

        <section class="quick-actions">
          <button id="clear-all" class="md-filled-button">Clear All</button>
        </section>

        <section class="info">
          <p><strong>Sprint Mode</strong>: Ephemeral highlighting</p>
          <ul>
            <li>Double-tap to highlight</li>
            <li>Ctrl+U to highlight selection</li>
            <li>Click to remove</li>
            <li>Ctrl+Shift+U to clear all</li>
          </ul>
        </section>
      </main>

      <footer>
        <span>v0.2.0 ‚Ä¢ Phase 4</span>
      </footer>
    </div>
  </div>

  <!-- TypeScript Controller (no inline scripts!) -->
  <script type="module" src="./popup-main.ts"></script>
</body>

</html>