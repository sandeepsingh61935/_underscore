import{i as e}from"./chunks/_virtual_wxt-plugins-CDnz5Vh6.js";const t=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;var s=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.NONE=999]="NONE",e))(s||{});class r{constructor(e,t=1){this.namespace=e,this.level=t}debug(e,...t){if(this.level<=0){const s=this.createEntry(0,e,t);console.debug(this.format(s),...t)}}info(e,...t){if(this.level<=1){const s=this.createEntry(1,e,t);console.info(this.format(s),...t)}}warn(e,...t){if(this.level<=2){const s=this.createEntry(2,e,t);console.warn(this.format(s),...t)}}error(e,t,...s){if(this.level<=3){const r=this.createEntry(3,e,s,t);console.error(this.format(r),t,...s),t?.stack&&console.error("Stack trace:",t.stack)}}setLevel(e){this.level=e}getLevel(){return this.level}createEntry(e,t,s,r){return{timestamp:new Date,level:e,namespace:this.namespace,message:t,metadata:s.length>0?{data:s}:void 0,error:r}}format(e){const t=s[e.level];return`[${e.timestamp.toISOString()}] [${t}] [${e.namespace}] ${e.message}`}}const a=class{static getLogger(e){if(!this.loggers.has(e)){const t=new r(e,this.defaultLevel);this.loggers.set(e,t)}return this.loggers.get(e)}static setGlobalLevel(e){this.defaultLevel=e;for(const t of this.loggers.values())t.setLevel(e)}static clearLoggers(){this.loggers.clear()}};a.defaultLevel=1,a.loggers=new Map;const o=a.getLogger("Background"),n=null==(l={type:"module",main(){o.info("Background service worker started (Sprint 1.5)"),t.alarms.create("ttl-cleanup",{periodInMinutes:5}),t.alarms.onAlarm.addListener(async e=>{"ttl-cleanup"===e.name&&await i()}),t.runtime.onStartup.addListener(async()=>{o.info("Browser startup detected, running cleanup"),await i()}),i()}})||"function"==typeof l?{main:l}:l;var l;async function i(){try{const e=await t.storage.local.get(null),s=Date.now(),r=[];for(const[t,a]of Object.entries(e))if(a&&"object"==typeof a&&"ttl"in a){s>a.ttl&&r.push(t)}r.length>0?(await t.storage.local.remove(r),o.info(`[Cleanup] Removed ${r.length} expired domains`)):o.debug("[Cleanup] No expired domains found")}catch(e){o.error("[Cleanup] Failed to cleanup expired domains",e)}}const c=(...e)=>{console.error};let u;try{e(),u=n.main(),u instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(g){throw c("The background crashed on startup!"),g}
